import{Kind as e}from"@0no-co/graphql.web";import{k as r,s as t,m as n,C as a,a as o,b as s,c as u,d as c,e as d,f as p,g as l,h as y}from"./urql-core-chunk.min.mjs";export{i as stringifyVariables}from"./urql-core-chunk.min.mjs";import{toPromise as k,take as f,filter as v,subscribe as h,map as x,tap as m,merge as w,mergeMap as b,takeUntil as g,make as q,onPush as _,share as O,fromPromise as S,fromValue as N,makeSubject as E,lazy as P,onStart as M,switchMap as R,publish as A,takeWhile as D,onEnd as j}from"wonka";var I=(e,r)=>{if(Array.isArray(e))for(var t of e)I(t,r);else if("object"==typeof e&&null!==e)for(var n in e)"__typename"===n&&"string"==typeof e[n]?r.add(e[n]):I(e[n],r);return r},Q=r=>{if("definitions"in r){var t=[];for(var n of r.definitions){var a=Q(n);t.push(a)}return{...r,definitions:t}}if("directives"in r&&r.directives&&r.directives.length){var o=[],i={};for(var s of r.directives){var u=s.name.value;"_"!==u[0]?o.push(s):u=u.slice(1),i[u]=s}r={...r,directives:o,_directives:i}}if("selectionSet"in r){var c=[],d=r.kind===e.OPERATION_DEFINITION;if(r.selectionSet){for(var p of r.selectionSet.selections||[]){d=d||p.kind===e.FIELD&&"__typename"===p.name.value&&!p.alias;var l=Q(p);c.push(l)}return d||c.push({kind:e.FIELD,name:{kind:e.NAME,value:"__typename"},_generated:!0}),{...r,selectionSet:{...r.selectionSet,selections:c}}}}return r},T=new Map,L=e=>{var t=r(e),n=T.get(t.__key);return n||(T.set(t.__key,n=Q(t)),Object.defineProperty(n,"__key",{value:t.__key,enumerable:!1})),n},F=(e,r)=>{if(e&&"object"==typeof e){if(Array.isArray(e))return e.map((e=>F(e)));if(e&&"object"==typeof e&&(r||"__typename"in e)){var t={};for(var n in e)"__typename"===n?Object.defineProperty(t,"__typename",{enumerable:!1,value:e.__typename}):t[n]=F(e[n]);return t}return e}return e};function J(e,r,t){return{...r,kind:e,context:r.context?{...r.context,...t}:t||r.context}}var C=()=>{};function G(n){for(var a=new Map,o=[],i=[],s=Array.isArray(n)?n[0]:n||"",u=1;u<arguments.length;u++){var c=arguments[u];c&&c.definitions?i.push(c):s+=c,s+=arguments[0][u]}for(var d of(i.unshift(r(s)),i))for(var p of d.definitions)if(p.kind===e.FRAGMENT_DEFINITION){var l=p.name.value,y=t(p);a.has(l)||(a.set(l,y),o.push(p))}else o.push(p);return r({kind:e.DOCUMENT,definitions:o})}var U=({kind:e})=>"mutation"!==e&&"query"!==e,V=e=>{var r=L(e.query);if(r!==e.query){var t=J(e.kind,e);return t.query=r,t}return e},W=({forward:e,client:r})=>{var t=new Map,a=new Map,o=e=>"query"===e.kind&&"network-only"!==e.context.requestPolicy&&("cache-only"===e.context.requestPolicy||t.has(e.key));return i=>{var s=x((e=>{var a=t.get(e.key)||n(e,{data:null});return a={...a,operation:e},"cache-and-network"===e.context.requestPolicy&&(a.stale=!0,$(r,e)),a}))(v((e=>!U(e)&&o(e)))(i)),u=m((e=>{var{operation:n}=e;if(n){var o=n.context.additionalTypenames||[];if("subscription"!==e.operation.kind&&(o=(e=>[...I(e,new Set)])(e.data).concat(o)),"mutation"===e.operation.kind||"subscription"===e.operation.kind){for(var i=new Set,s=0;s<o.length;s++){var u=o[s],c=a.get(u);for(var d of(c||a.set(u,c=new Set),c.values()))i.add(d);c.clear()}for(var p of i.values())t.has(p)&&(n=t.get(p).operation,t.delete(p),$(r,n))}else if("query"===n.kind&&e.data){t.set(n.key,e);for(var l=0;l<o.length;l++){var y=o[l],k=a.get(y);k||a.set(y,k=new Set),k.add(n.key)}}}}))(e(v((e=>"query"!==e.kind||"cache-only"!==e.context.requestPolicy))(x((e=>e))(w([x(V)(v((e=>!U(e)&&!o(e)))(i)),v((e=>U(e)))(i)])))));return w([s,u])}},$=(e,r)=>e.reexecuteOperation(J(r.kind,r,{requestPolicy:"network-only"})),z=new Set,B=(e={})=>{var r=!!e.staleWhileRevalidate,t=!!e.includeExtensions,n={},o=[],i=e=>{o.push(e.operation.key),1===o.length&&Promise.resolve().then((()=>{for(var e;e=o.shift();)n[e]=null}))},s=({client:o,forward:s})=>u=>{var c=e&&"boolean"==typeof e.isClient?!!e.isClient:!o.suspense,d=s(x(V)(v((e=>"teardown"===e.kind||!n[e.key]||!!n[e.key].hasNext||"network-only"===e.context.requestPolicy))(u))),p=x((e=>{var i=((e,r,t)=>({operation:e,data:r.data?JSON.parse(r.data):void 0,extensions:t&&r.extensions?JSON.parse(r.extensions):void 0,error:r.error?new a({networkError:r.error.networkError?new Error(r.error.networkError):void 0,graphQLErrors:r.error.graphQLErrors}):void 0,stale:!1,hasNext:!!r.hasNext}))(e,n[e.key],t);return r&&!z.has(e.key)&&(i.stale=!0,z.add(e.key),$(o,e)),{...i,operation:e}}))(v((e=>"teardown"!==e.kind&&!!n[e.key]&&"network-only"!==e.context.requestPolicy))(u));return c?p=m(i)(p):d=m((e=>{var{operation:r}=e;if("mutation"!==r.kind){var a=((e,r)=>{var t={data:JSON.stringify(e.data),hasNext:e.hasNext};return void 0!==e.data&&(t.data=JSON.stringify(e.data)),r&&void 0!==e.extensions&&(t.extensions=JSON.stringify(e.extensions)),e.error&&(t.error={graphQLErrors:e.error.graphQLErrors.map((e=>e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message))},e.error.networkError&&(t.error.networkError=""+e.error.networkError)),t})(e,t);n[r.key]=a}}))(d),w([d,p])};return s.restoreData=e=>{for(var r in e)null!==n[r]&&(n[r]=e[r])},s.extractData=()=>{var e={};for(var r in n)null!=n[r]&&(e[r]=n[r]);return e},e&&e.initialState&&s.restoreData(e.initialState),s},H=({forwardSubscription:e,enableAllOperations:r,isSubscriptionOperation:t})=>({client:a,forward:i})=>{var c=t||(e=>"subscription"===e.kind||!!r&&("query"===e.kind||"mutation"===e.kind));return r=>{var t=b((t=>{var{key:i}=t,c=v((e=>"teardown"===e.kind&&e.key===i))(r);return g(c)((r=>{var t=e(o(r),r);return q((e=>{var o,i,c=!1;function d(t){e.next(i=i?u(i,t):n(r,t))}return Promise.resolve().then((()=>{c||(o=t.subscribe({next:d,error(t){Array.isArray(t)?d({errors:t}):e.next(s(r,t)),e.complete()},complete(){c||(c=!0,"subscription"===r.kind&&a.reexecuteOperation(J("teardown",r,r.context)),i&&i.hasNext&&d({hasNext:!1}),e.complete())}}))})),()=>{c=!0,o&&o.unsubscribe()}}))})(t))}))(v((e=>"teardown"!==e.kind&&c(e)))(r)),d=i(v((e=>"teardown"===e.kind||!c(e)))(r));return w([t,d])}},K=({forward:e})=>r=>e(r),X=({forward:e})=>r=>e(r),Y=({forward:e})=>r=>{var t=b((e=>{var t=o(e),n=c(e,t),a=d(e,t);return g(v((r=>"teardown"===r.kind&&r.key===e.key))(r))(p(e,n,a))}))(v((e=>"teardown"!==e.kind&&("subscription"!==e.kind||!!e.context.fetchSubscriptions)))(r)),n=e(v((e=>"teardown"===e.kind||"subscription"===e.kind&&!e.context.fetchSubscriptions))(r));return w([t,n])},Z=e=>({client:r,forward:t})=>e.reduceRight(((e,t)=>t({client:r,forward:r=>O(e(O(r))),dispatchDebug(e){}})),t),ee=({onOperation:e,onResult:r,onError:t})=>({forward:n})=>a=>b((e=>{t&&e.error&&t(e.error,e.operation);var n=r&&r(e)||e;return"then"in n?S(n):N(n)}))(n(b((r=>{var t=e&&e(r)||r;return"then"in t?S(t):N(t)}))(a))),re=({})=>e=>v((e=>!1))(e),te=function e(r){var t=0,n=new Map,a=new Map,o=new Set,i=[],s={url:r.url,fetchSubscriptions:r.fetchSubscriptions,fetchOptions:r.fetchOptions,fetch:r.fetch,preferGetMethod:r.preferGetMethod,requestPolicy:r.requestPolicy||"cache-first"},u=E();function c(e){"mutation"!==e.kind&&"teardown"!==e.kind&&o.has(e.key)||("teardown"===e.kind?o.delete(e.key):"mutation"!==e.kind&&o.add(e.key),u.next(e))}var d=!1;function p(e){if(e&&c(e),!d){for(d=!0;d&&(e=i.shift());)c(e);d=!1}}var l=e=>{var t=g(v((r=>"teardown"===r.kind&&r.key===e.key))(u.source))(v((r=>r.operation.kind===e.kind&&r.operation.key===e.key&&(!r.operation.context._instance||r.operation.context._instance===e.context._instance)))(I));return r.maskTypename&&(t=x((e=>({...e,data:F(e.data,!0)})))(t)),t="query"!==e.kind?D((e=>!!e.hasNext),!0)(t):R((r=>{var t=N(r);return r.stale||r.hasNext?t:w([t,x((()=>(r.stale=!0,r)))(f(1)(v((r=>r.key===e.key))(u.source)))])}))(t),t="mutation"!==e.kind?j((()=>{o.delete(e.key),n.delete(e.key),a.delete(e.key),d=!1;for(var r=i.length-1;r>=0;r--)i[r].key===e.key&&i.splice(r,1);c(J("teardown",e,e.context))}))(_((r=>{if(r.stale){for(var t of i)if(t.key===r.operation.key){o.delete(t.key);break}}else r.hasNext||o.delete(e.key);n.set(e.key,r)}))(t)):M((()=>{c(e)}))(t),O(t)},m=this instanceof e?this:Object.create(e.prototype),b=Object.assign(m,{suspense:!!r.suspense,operations$:u.source,reexecuteOperation(e){if("teardown"===e.kind)p(e);else if("mutation"===e.kind||a.has(e.key)){for(var r=!1,t=0;t<i.length;t++)r=r||i[t].key===e.key;r||o.delete(e.key),i.push(e),Promise.resolve().then(p)}},createRequestOperation:(e,r,n)=>(n||(n={}),J(e,r,{_instance:"mutation"===e?t=t+1|0:void 0,...s,...n,requestPolicy:n.requestPolicy||s.requestPolicy,suspense:n.suspense||!1!==n.suspense&&b.suspense})),executeRequestOperation:e=>{return r="mutation"===e.kind?l(e):P((()=>{var r=a.get(e.key);r||a.set(e.key,r=l(e)),r=M((()=>{p(e)}))(r);var t=n.get(e.key);return"query"===e.kind&&t&&(t.stale||t.hasNext)?R(N)(w([r,v((r=>r===n.get(e.key)))(N(t))])):r})),(t=e=>r(e)).toPromise=()=>k(f(1)(v((e=>!e.stale&&!e.hasNext))(t))),t.then=(e,r)=>t.toPromise().then(e,r),t.subscribe=e=>h(e)(t),t;var r,t},executeQuery(e,r){var t=b.createRequestOperation("query",e,r);return b.executeRequestOperation(t)},executeSubscription(e,r){var t=b.createRequestOperation("subscription",e,r);return b.executeRequestOperation(t)},executeMutation(e,r){var t=b.createRequestOperation("mutation",e,r);return b.executeRequestOperation(t)},readQuery(e,r,t){var n=null;return h((e=>{n=e}))(b.query(e,r,t)).unsubscribe(),n},query:(e,r,t)=>b.executeQuery(y(e,r),t),subscription:(e,r,t)=>b.executeSubscription(y(e,r),t),mutation:(e,r,t)=>b.executeMutation(y(e,r),t)}),q=C,S=Z(r.exchanges),I=O(S({client:b,dispatchDebug:q,forward:re({dispatchDebug:q})})(u.source));return A(I),b},ne=te;export{te as Client,a as CombinedError,W as cacheExchange,Z as composeExchanges,ne as createClient,y as createRequest,K as debugExchange,X as dedupExchange,ee as errorExchange,Y as fetchExchange,L as formatDocument,G as gql,s as makeErrorResult,J as makeOperation,n as makeResult,ee as mapExchange,F as maskTypename,u as mergeResultPatch,B as ssrExchange,t as stringifyDocument,H as subscriptionExchange};
//# sourceMappingURL=urql-core.min.mjs.map
